import json
import unittest

from rs.ai.requested_strike.handlers.path_handler import PathHandler
from rs.ai.requested_strike.handlers.smart_path_handler import SmartPathHandler
from rs.machine.state import GameState

STATE = '{"available_commands":["choose","return","key","click","wait","state"],"ready_for_command":true,"in_game":true,"game_state":{"choice_list":["x\u003d1","x\u003d2","x\u003d4","x\u003d6"],"screen_type":"MAP","screen_state":{"first_node_chosen":false,"current_node":{"x":0,"y":-1},"boss_available":false,"next_nodes":[{"symbol":"M","x":1,"y":0},{"symbol":"M","x":2,"y":0},{"symbol":"M","x":4,"y":0},{"symbol":"M","x":6,"y":0}]},"seed":-380645016277662643,"deck":[{"exhausts":false,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"8d80d962-c819-442d-99b3-381af915a509","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"d48a9554-a527-4916-b9a4-231a248b19fa","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"ef4aa7bb-9d2c-4fd3-9670-e706315c87a7","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"3b8f9698-7a5e-40a1-9097-765e136cedd8","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"cost":1,"name":"Strike","id":"Strike_R","type":"ATTACK","ethereal":false,"uuid":"3fd5349f-a7b3-4b69-be24-f9241303e782","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":false,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"1d065e70-6981-4da1-9090-a925831be677","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"ef526ed4-c93f-43d1-a0b7-7e4229319306","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"6b13722f-d646-468a-a717-90ac3ad39cb1","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"cost":1,"name":"Defend","id":"Defend_R","type":"SKILL","ethereal":false,"uuid":"3e07c7b6-3b7e-405c-a77d-c69c46a74f12","upgrades":0,"rarity":"BASIC","has_target":false},{"exhausts":false,"cost":2,"name":"Bash","id":"Bash","type":"ATTACK","ethereal":false,"uuid":"f961e2c3-c361-43b3-ba63-245a77cacd0b","upgrades":0,"rarity":"BASIC","has_target":true},{"exhausts":true,"cost":1,"name":"Madness","id":"Madness","type":"SKILL","ethereal":false,"uuid":"a0b766a7-ad76-4e72-b4d9-706d529007ae","upgrades":0,"rarity":"UNCOMMON","has_target":false}],"relics":[{"name":"Burning Blood","id":"Burning Blood","counter":-1}],"max_hp":80,"act_boss":"Hexaghost","gold":99,"action_phase":"WAITING_ON_USER","act":1,"screen_name":"MAP","room_phase":"COMPLETE","is_screen_up":true,"potions":[{"requires_target":false,"can_use":false,"can_discard":false,"name":"Potion Slot","id":"Potion Slot"},{"requires_target":false,"can_use":false,"can_discard":false,"name":"Potion Slot","id":"Potion Slot"},{"requires_target":false,"can_use":false,"can_discard":false,"name":"Potion Slot","id":"Potion Slot"}],"current_hp":80,"floor":0,"ascension_level":0,"class":"IRONCLAD","map":[{"symbol":"M","children":[{"x":1,"y":1}],"x":1,"y":0,"parents":[]},{"symbol":"M","children":[{"x":2,"y":1}],"x":2,"y":0,"parents":[]},{"symbol":"M","children":[{"x":5,"y":1}],"x":4,"y":0,"parents":[]},{"symbol":"M","children":[{"x":6,"y":1}],"x":6,"y":0,"parents":[]},{"symbol":"M","children":[{"x":2,"y":2}],"x":1,"y":1,"parents":[]},{"symbol":"?","children":[{"x":3,"y":2}],"x":2,"y":1,"parents":[]},{"symbol":"$","children":[{"x":4,"y":2},{"x":6,"y":2}],"x":5,"y":1,"parents":[]},{"symbol":"M","children":[{"x":6,"y":2}],"x":6,"y":1,"parents":[]},{"symbol":"M","children":[{"x":1,"y":3},{"x":3,"y":3}],"x":2,"y":2,"parents":[]},{"symbol":"M","children":[{"x":3,"y":3}],"x":3,"y":2,"parents":[]},{"symbol":"M","children":[{"x":4,"y":3}],"x":4,"y":2,"parents":[]},{"symbol":"?","children":[{"x":5,"y":3},{"x":6,"y":3}],"x":6,"y":2,"parents":[]},{"symbol":"M","children":[{"x":1,"y":4}],"x":1,"y":3,"parents":[]},{"symbol":"?","children":[{"x":2,"y":4}],"x":3,"y":3,"parents":[]},{"symbol":"$","children":[{"x":5,"y":4}],"x":4,"y":3,"parents":[]},{"symbol":"M","children":[{"x":5,"y":4}],"x":5,"y":3,"parents":[]},{"symbol":"$","children":[{"x":6,"y":4}],"x":6,"y":3,"parents":[]},{"symbol":"M","children":[{"x":1,"y":5}],"x":1,"y":4,"parents":[]},{"symbol":"M","children":[{"x":1,"y":5}],"x":2,"y":4,"parents":[]},{"symbol":"M","children":[{"x":5,"y":5},{"x":6,"y":5}],"x":5,"y":4,"parents":[]},{"symbol":"M","children":[{"x":6,"y":5}],"x":6,"y":4,"parents":[]},{"symbol":"E","children":[{"x":0,"y":6},{"x":1,"y":6}],"x":1,"y":5,"parents":[]},{"symbol":"R","children":[{"x":4,"y":6}],"x":5,"y":5,"parents":[]},{"symbol":"E","children":[{"x":5,"y":6},{"x":6,"y":6}],"x":6,"y":5,"parents":[]},{"symbol":"R","children":[{"x":0,"y":7},{"x":1,"y":7}],"x":0,"y":6,"parents":[]},{"symbol":"?","children":[{"x":1,"y":7}],"x":1,"y":6,"parents":[]},{"symbol":"E","children":[{"x":3,"y":7}],"x":4,"y":6,"parents":[]},{"symbol":"R","children":[{"x":5,"y":7}],"x":5,"y":6,"parents":[]},{"symbol":"?","children":[{"x":6,"y":7}],"x":6,"y":6,"parents":[]},{"symbol":"M","children":[{"x":0,"y":8}],"x":0,"y":7,"parents":[]},{"symbol":"?","children":[{"x":1,"y":8},{"x":2,"y":8}],"x":1,"y":7,"parents":[]},{"symbol":"R","children":[{"x":2,"y":8}],"x":3,"y":7,"parents":[]},{"symbol":"?","children":[{"x":5,"y":8}],"x":5,"y":7,"parents":[]},{"symbol":"?","children":[{"x":5,"y":8}],"x":6,"y":7,"parents":[]},{"symbol":"T","children":[{"x":0,"y":9}],"x":0,"y":8,"parents":[]},{"symbol":"T","children":[{"x":1,"y":9}],"x":1,"y":8,"parents":[]},{"symbol":"T","children":[{"x":3,"y":9}],"x":2,"y":8,"parents":[]},{"symbol":"T","children":[{"x":5,"y":9},{"x":6,"y":9}],"x":5,"y":8,"parents":[]},{"symbol":"R","children":[{"x":1,"y":10}],"x":0,"y":9,"parents":[]},{"symbol":"M","children":[{"x":1,"y":10}],"x":1,"y":9,"parents":[]},{"symbol":"M","children":[{"x":3,"y":10},{"x":4,"y":10}],"x":3,"y":9,"parents":[]},{"symbol":"?","children":[{"x":5,"y":10}],"x":5,"y":9,"parents":[]},{"symbol":"M","children":[{"x":5,"y":10}],"x":6,"y":9,"parents":[]},{"symbol":"?","children":[{"x":1,"y":11},{"x":2,"y":11}],"x":1,"y":10,"parents":[]},{"symbol":"R","children":[{"x":2,"y":11}],"x":3,"y":10,"parents":[]},{"symbol":"M","children":[{"x":3,"y":11}],"x":4,"y":10,"parents":[]},{"symbol":"M","children":[{"x":6,"y":11}],"x":5,"y":10,"parents":[]},{"symbol":"R","children":[{"x":2,"y":12}],"x":1,"y":11,"parents":[]},{"symbol":"M","children":[{"x":2,"y":12},{"x":3,"y":12}],"x":2,"y":11,"parents":[]},{"symbol":"M","children":[{"x":3,"y":12}],"x":3,"y":11,"parents":[]},{"symbol":"M","children":[{"x":5,"y":12}],"x":6,"y":11,"parents":[]},{"symbol":"?","children":[{"x":2,"y":13}],"x":2,"y":12,"parents":[]},{"symbol":"M","children":[{"x":3,"y":13}],"x":3,"y":12,"parents":[]},{"symbol":"E","children":[{"x":4,"y":13},{"x":5,"y":13}],"x":5,"y":12,"parents":[]},{"symbol":"?","children":[{"x":2,"y":14}],"x":2,"y":13,"parents":[]},{"symbol":"?","children":[{"x":3,"y":14}],"x":3,"y":13,"parents":[]},{"symbol":"M","children":[{"x":4,"y":14}],"x":4,"y":13,"parents":[]},{"symbol":"M","children":[{"x":5,"y":14}],"x":5,"y":13,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":2,"y":14,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":3,"y":14,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":4,"y":14,"parents":[]},{"symbol":"R","children":[{"x":3,"y":16}],"x":5,"y":14,"parents":[]}],"room_type":"NeowRoom"}}'

class SmartPathHandlerTestCase(unittest.TestCase):

    def test_no_errors_on_basic(self):
        handler = SmartPathHandler()
        state = GameState(json.loads(STATE))

        self.assertTrue(handler.can_handle(state))
        self.assertEqual(["choose 0"], handler.handle(state))

if __name__ == '__main__':
    unittest.main()
